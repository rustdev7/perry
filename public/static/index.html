<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tabla de Productos Responsive (Tabulator 6.3)</title>

<!-- Tabulator 6.3.1 -->
<link href="https://unpkg.com/tabulator-tables@6.3.1/dist/css/tabulator.min.css" rel="stylesheet">
<script type="text/javascript" src="https://unpkg.com/tabulator-tables@6.3.1/dist/js/tabulator.min.js"></script>

<!-- SheetJS -->
<script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

<style>
/* ------------------------------------------------ */
/* --- ESTILOS GENERALES MODO OSCURO --- */
/* ------------------------------------------------ */

body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  padding: 1px;
  background: #1a1a1a;
}

#tabla {
  background: #2d2d2d;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.5);
  width: 100%;
  margin: 0 auto;
}

/* Tabla principal - sin bordes */
.tabulator {
  font-size: 14px;
  background: #2d2d2d !important;
  border: none !important;
  color: #e0e0e0;
}

/* Header - sin bordes - FORZAR VISIBILIDAD */
.tabulator-header {
  background: #252525 !important;
  border-bottom: none !important;
  border: none !important;
  color: #ffffff !important;
}

.tabulator-col {
  background: #252525 !important;
  border-right: none !important;
  border: none !important;
  color: #ffffff !important;
}

.tabulator-col-content {
  color: #ffffff !important;
}

.tabulator-col-title {
  color: #ffffff !important;
  font-weight: 600;
}

.tabulator-col-content .tabulator-col-title {
  color: #ffffff !important;
}

/* Filas - ELIMINAR TODOS LOS BORDES */
.tabulator-row {
  background: #2d2d2d !important;
  border: none !important;
  border-top: none !important;
  border-bottom: none !important;
  color: #e0e0e0;
}

.tabulator-row:hover {
  background: #000000 !important;
}

.tabulator-row.tabulator-row-even {
  background: #323232 !important;
}

.tabulator-row.tabulator-row-even:hover {
  background: #000000 !important;
}

/* Celdas - sin bordes */
.tabulator-cell {
  color: #e0e0e0 !important;
  border: none !important;
  border-right: none !important;
  border-left: none !important;
  border-top: none !important;
  border-bottom: none !important;
  white-space: normal;
  overflow: visible;
}

/* ELIMINAR COMPLETAMENTE EL ÁREA DE COLLAPSE */
.tabulator-row .tabulator-responsive-collapse {
  display: none !important;
  height: 0 !important;
  padding: 0 !important;
  margin: 0 !important;
  border: none !important;
}

/* Footer - sin bordes */
.tabulator-footer {
  background: #252525 !important;
  border: none !important;
  color: #e0e0e0;
}

.tabulator-page {
  background: #3a3a3a;
  color: #e0e0e0;
  border: none;
}

.tabulator-page:hover {
  background: #4a4a4a;
}

.tabulator-page.active {
  background: #555;
  color: white;
}

/* Inputs de filtro - sin bordes */
.tabulator-header-filter input {
  background: #3a3a3a;
  border: none;
  color: #e0e0e0;
}

.tabulator-header-filter input::placeholder {
  color: #888;
}

/* ---------------------------------------------------- */
/* --- ESTILOS ADICIONALES PARA LA VISTA DE TARJETA --- */
/* ---------------------------------------------------- */

.tabulator-responsive-collapse {
    padding: 10px;
    background: #3a3a3a; 
    border-radius: 6px;
    margin: 5px 0;
}

.card-item {
    padding: 5px 0;
    border-bottom: none;
    display: flex; 
    flex-wrap: wrap;
}

.card-item:last-child {
    border-bottom: none;
}

.card-item strong {
    min-width: 90px; 
    color: #bdbdbd; 
    margin-right: 5px; 
}

.card-item span {
    flex: 1;
    white-space: normal;
    word-wrap: break-word;
}

.card-image-container {
    text-align: center;
    padding: 10px;
    width: 100%;
    min-height: 120px;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #2a2a2a;
    border-radius: 6px;
    margin-bottom: 10px;
}

.card-image-container img {
    display: block !important;
    max-width: 100% !important;
    max-height: 200px !important;
    height: auto !important;
    width: auto !important;
    margin: 0 auto !important;
    object-fit: contain !important;
    border-radius: 4px;
}

/* ------------------------------------------------ */
/* --- OPTIMIZACIÓN DE PAGINACIÓN Y FILTROS MÓVIL --- */
/* ------------------------------------------------ */

@media (max-width: 768px) {
    /* Mostrar collapse en móvil */
    .tabulator-row .tabulator-responsive-collapse {
        display: block !important;
        height: auto !important;
        padding: 10px !important;
        margin: 5px 0 !important;
    }
    
    /* Paginación Responsive */
    .tabulator-footer {
        flex-wrap: wrap; 
        justify-content: center; 
        padding: 5px;
    }

    /* Ocultar elementos que ocupan espacio */
    .tabulator-page-size {
        display: none !important;
    }
    .tabulator-page[data-page="first"], 
    .tabulator-page[data-page="last"] {
        display: none !important;
    }
    
    /* Estilos más pequeños para botones */
    .tabulator-page, 
    .tabulator-page.active, 
    .tabulator-page:hover {
        min-width: 30px; 
        padding: 5px 8px;
        margin: 2px;
        font-size: 12px;
    }

    /* Oculta el filtro de la columna ID */
    .columna-id .tabulator-header-filter {
        display: none !important;
    }
}
</style>

</head>
<body>

<div id="tabla"></div>

<script>
// Función para crear la tabla
function crearTabla(datos) {
  const table = new Tabulator("#tabla", {
    data: datos,
    
    // Layout responsive - SIN botón de toggle
    layout: "fitColumns",
    responsiveLayout: "collapse",
    
    // Paginación
    pagination: true,
    paginationMode: "local",
    paginationSize: 5,
    paginationSizeSelector: [5, 10, 25, 50, 100], 
    
    // Formatea la vista de tarjeta
    responsiveLayoutCollapseFormatter: function(data){
        var output = document.createElement("div");
        output.classList.add("tabulator-responsive-collapse");

        // Primero buscar la imagen
        var fotoItem = data.find(function(item){ return item.field === "FOTO"; });
        
        if (fotoItem && fotoItem.value) {
            var imageContainer = document.createElement("div");
            imageContainer.classList.add("card-image-container");
            
            var img = document.createElement("img");
            
            // Extraer la URL real - puede venir como string o como elemento
            var imgSrc = fotoItem.value;
            if (typeof imgSrc === 'object' && imgSrc.src) {
                imgSrc = imgSrc.src;
            } else if (typeof imgSrc !== 'string') {
                imgSrc = String(imgSrc);
            }
            imgSrc = imgSrc.trim();
            
            img.src = imgSrc;
            img.alt = "Foto del producto";
            img.loading = "lazy";
            
            img.onload = function() {
                console.log("✓ Imagen cargada en móvil:", imgSrc);
            };
            
            img.onerror = function() {
                console.error("✗ Error cargando imagen en móvil:", imgSrc);
                console.error("Tipo de valor recibido:", typeof fotoItem.value);
                console.error("Valor original:", fotoItem.value);
            };
            
            imageContainer.appendChild(img);
            output.appendChild(imageContainer);
        }

        // Luego agregar el resto de los datos (excepto FOTO)
        data.forEach(function(item){
            if (item.field !== "FOTO") {
                const itemValue = String(item.value || ''); 
                
                var cardItem = document.createElement("div");
                cardItem.classList.add("card-item");
                
                var title = document.createElement("strong");
                title.textContent = item.title + ":"; 
                
                var value = document.createElement("span");
                value.textContent = itemValue; 
                
                cardItem.appendChild(title);
                cardItem.appendChild(value);
                output.appendChild(cardItem);
            }
        });

        return output; 
    },
    
    // Búsqueda
    headerFilterPlaceholder: "Buscar...",
    
    // Columnas
    columns: [
      {
        title: "ID",
        field: "ID",
        width: 50,
        hozAlign: "center",
        headerFilter: "input",
        responsive: 2,
        cssClass: "columna-id"
      },
      {
        title: "ARTÍCULO",
        field: "ARTICULO",
        headerFilter: "input",
        responsive: 0
      },
      {
        title: "CATEGORÍA",
        field: "CATEGORIA",
        headerFilter: "input",
        responsive: 1
      },
      {
        title: "DESCRIPCIÓN",
        field: "DESCRIPCION",
        headerFilter: "input",
        minWidth: 270,
        formatter: "textarea",
        variableHeight: true,
        responsive: 3
      },
      {
        title: "PRECIO",
        field: "PRECIO",
        width: 90,
        headerFilter: "input",
        formatter: "money",
        formatterParams: {
          symbol: "$",
          precision: 2
        },
        responsive: 4
      },
      {
        title: "FOTO",
        field: "FOTO",
        formatter: "image",
        formatterParams: {
          height: "100px",
          width: "100px"
        },
        headerFilter: false,
        responsive: 5
      }
    ],
    
    // Idioma español
    locale: true,
    langs: {
      "default": {
        "pagination": {
          "first": "Primera",
          "first_title": "Primera Página",
          "last": "Última",
          "last_title": "Última Página",
          "prev": "Anterior",
          "prev_title": "Página Anterior",
          "next": "Siguiente",
          "next_title": "Página Siguiente",
          "page_size": "Elementos por página"
        },
        "headerFilters": {
          "default": "filtrar..."
        }
      }
    }
  });
  
  table.on("tableBuilt", function(){
    console.log("Tabla construida con éxito - Tabulator 6.3.1");
  });
}

// Función para cargar Excel automáticamente
async function cargarExcel() {
  try {
    const response = await fetch('datos.xlsx');
    
    if (!response.ok) {
      throw new Error(`No se encontró el archivo: ${response.status}`);
    }
    
    const arrayBuffer = await response.arrayBuffer();
    const workbook = XLSX.read(arrayBuffer, { type: 'array' });
    const firstSheetName = workbook.SheetNames[0];
    const worksheet = workbook.Sheets[firstSheetName];
    const jsonData = XLSX.utils.sheet_to_json(worksheet);
    
    crearTabla(jsonData);
    
  } catch (error) {
    console.error("Error cargando Excel:", error);
    
    console.warn("Cargando datos de ejemplo...");
    const datosEjemplo = [
      { ID: 1, ARTICULO: "Batería", CATEGORIA: "Eléctrico", DESCRIPCION: "Batería de Gel 12v", PRECIO: 3000, FOTO: "https://picsum.photos/150/150?random=1" },
      { ID: 2, ARTICULO: "Cilindro", CATEGORIA: "Motor", DESCRIPCION: "Kit Cilindro CG-125", PRECIO: 8500, FOTO: "https://picsum.photos/150/150?random=2" },
      { ID: 3, ARTICULO: "Pastillas", CATEGORIA: "Frenos", DESCRIPCION: "Pastillas Delanteras", PRECIO: 1500, FOTO: "https://picsum.photos/150/150?random=3" },
      { ID: 4, ARTICULO: "Aceite", CATEGORIA: "Lubricante", DESCRIPCION: "Aceite 10W40 1L", PRECIO: 950, FOTO: "https://picsum.photos/150/150?random=4" },
      { ID: 5, ARTICULO: "Casco", CATEGORIA: "Accesorios", DESCRIPCION: "Casco Talle L", PRECIO: 12000, FOTO: "https://picsum.photos/150/150?random=5" },
      { ID: 6, ARTICULO: "Bujía", CATEGORIA: "Motor", DESCRIPCION: "Bujía Iridium", PRECIO: 600, FOTO: "https://picsum.photos/150/150?random=6" }
    ];
    
    crearTabla(datosEjemplo);
    
    setTimeout(() => {
      const warning = document.createElement('div');
      warning.style.cssText = 'position: fixed; top: 20px; right: 20px; padding: 15px; background: #ff9800; color: white; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); z-index: 9999;';
      warning.innerHTML = `⚠️ No se encontró datos.xlsx<br><small>Mostrando datos de ejemplo</small>`;
      document.body.appendChild(warning);
      
      setTimeout(() => warning.remove(), 5000);
    }, 100);
  }
}

cargarExcel();
</script>

</body>
</html>